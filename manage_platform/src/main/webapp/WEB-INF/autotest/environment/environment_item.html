<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <script src="../../js/alert.js" type="text/javascript"></script>


</head>

<body>
<!-- 	 -->
<div class="panel-heading">
    <ol class="breadcrumb">
        <li><a href="#">接口自动化</a></li>
        <li><a href="#">测试环境管理</a></li>
        <li class="active">新增测试环境</li>
    </ol>
</div>
<div class="col-lg-14">
    <div class="panel panel-default">
        <div id="case-form-div">
            <form  role="form" class="case-form" id="add-environment">
            <input type="hidden" name="id" value="${environmentDto.id}">
                <div class="form-group ">
                    <label>环境名</label>
                    <input class="form-control col-lg-5" name="name" value="${environmentDto.name}">
                </div>
                <!--环境id-->
                <div class="form-group ">
                    <label>环境描述</label>
                    <input class="form-control col-lg-5" name="description" value="${environmentDto.description}">
                </div>
                <!--所属系统-->
                <div class="form-group ">
                    <label>系统</label>
                    <select class="form-control col-lg-5" name="systemId">
                        <option value="" <#if environmentDto.systemId = null>disabled selected</#if>>选择系统</option>
                        <#if systemList ??>
                            <#list systemList as item>
                                <option value="${item.id}" <#if environmentDto.systemId = item.id>selected</#if>>${item.name}</option>
                            </#list>
                        </#if>
                    </select>
                </div>
                <div class="form-group ">
                    <label>新增配置</label>
                    <div class="choose-sys case-choose" style="display: inline-flex">
                        <label class="checkbox-inline" style="margin-top: 0">
                            <input type="checkbox" value="serviceProperties" name="serviceProperties">服务配置
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" value="zkProperties" name="zkProperties">zk配置
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" value="dbProperties" name="dbProperties">数据库配置
                        </label>
                        <label class="checkbox-inline">
                            <input type="checkbox" value="redisProperties" name="redisProperties">redis配置
                        </label>
                    </div>
                </div>
                <div class="form-group upto-left">
                    <a type="button" class="btn btn-primary" onclick="saveEnvironment()">保存</a>
                </div>
        </form>
            <!--service配置-->
            <div id="service-form-div" class="panel panel-default panel-collapse collapse operation-width">
                <!-- service配置 -->
                <label class="control-label col-lg-4 top-label">服务配置</label>

                <div class="panel panel-default operation">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table case-table">
                                <thead>
                                <tr>
                                    <th style="width: 20%">服务名</th>
                                    <th style="width: 30%">ip</th>
                                    <th style="width: 20%">http端口号</th>
                                    <th style="width: 20%">dubbo端口号</th>
                                    <th>操作</th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <div class="row">
                                        <td>
                                            <select class="form-control" name="serviceId">
                                                <#if serviceList ??>
                                                    <#list serviceList as item>
                                                        <option value="${item.id}">${item.name}</option>
                                                    </#list>
                                                </#if>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control" name="ipAddress"></td>
                                        <td><input type="text" class="form-control" name="httpPort"></td>
                                        <td><input type="text" class="form-control" name="dubboPort"></td>
                                        <td>
                                            <button type="submit" class="btn btn-info"  onclick="saveServiceProperties(this)">保存</button>
                                        </td>
                                        <td>
                                            <button type="button" name="delete" class="btn btn-info">删除</button>
                                        </td>
                                    </div>
                                </tr>
                                <tr>
                                    <td style=" border: none"><span id="addServiceProperties"
                                                                    class="btn btn-info"><i
                                            class="icon icon-plus-sign"></i>添加服务配置</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!--zk配置-->
            <div id="zk-form-div" class="panel panel-default panel-collapse collapse operation-width">
                <!-- zk配置 -->
                <label class="control-label col-lg-4 top-label">zk配置</label>

                <div class="panel panel-default operation">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table case-table">
                                <thead>
                                <tr>
                                    <th style="width: 30%">服务名</th>
                                    <th style="width: 60%">ip和端口号</th>
                                    <th>操作</th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <div class="row">
                                        <td>
                                            <select class="form-control">
                                                <#if serviceList ??>
                                                    <#list serviceList as item>
                                                        <option value="${item.id}">${item.name}</option>
                                                    </#list>
                                                </#if>
                                            </select>
                                        </td>
                                        <td><textarea type="text" class="form-control"
                                                      style="width: 100% ;height: 34px;resize: vertical" name="httpAddress"></textarea></td>

                                        <td>
                                            <button type="submit" class="btn btn-info">保存</button>
                                        </td>
                                        <td>
                                            <button type="button" name="delete" class="btn btn-info">删除</button>
                                        </td>
                                    </div>
                                </tr>
                                <tr>
                                    <td style=" border: none"><span id="addZkProperties"
                                                                    class="btn btn-info"><i
                                            class="icon icon-plus-sign"></i>添加Zk配置</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!--数据库配置-->
            <div id="db-form-div" class="panel panel-default panel-collapse collapse operation-width">
                <!-- 数据库配置 -->
                <label class="control-label col-lg-4 top-label">数据库配置</label>

                <div class="panel panel-default operation">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table case-table">
                                <thead>
                                <tr>
                                    <th style="width: 10%">数据库配置名</th>
                                    <th style="width: 10%">数据库类型</th>
                                    <th style="width: 15%">ip</th>
                                    <th style="width: 10%">端口号</th>
                                    <th style="width: 15%">库名</th>
                                    <th style="width: 15%">用户名</th>
                                    <th style="width: 15%">密码</th>
                                    <th>操作</th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <div class="row">
                                        <td><input type="text" class="form-control"></td>
                                        <td>
                                            <select class="form-control">
                                                <#if databaseTypeEnumList ??>
                                                    <#list databaseTypeEnumList as item>
                                                        <option values="${item.getId()}"> ${item.getName()}</option>
                                                    </#list>
                                                </#if>
                                            </select>
                                        </td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="text" class="form-control"></td>
                                        <td>
                                            <button type="submit" class="btn btn-info">保存</button>
                                        </td>
                                        <td>
                                            <button type="button" name="delete" class="btn btn-info">删除</button>
                                        </td>
                                    </div>
                                </tr>
                                <tr>
                                    <td style=" border: none"><span id="addDbProperties"
                                                                    class="btn btn-info"><i
                                            class="icon icon-plus-sign"></i>添加数据库配置</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
            <!--redis配置-->
            <div id="redis-form-div" class="panel panel-default panel-collapse collapse operation-width">
                <!-- redis配置 -->
                <label class="control-label col-lg-4 top-label">redis配置</label>

                <div class="panel panel-default operation">
                    <div class="panel-body">
                        <div class="table-responsive">
                            <table class="table case-table">
                                <thead>
                                <tr>
                                    <th style="width: 10%">redis名</th>
                                    <th style="width: 10%">timeout</th>
                                    <th style="width: 10%">重试次数</th>
                                    <th style="width: 60%">集群</th>
                                    <th>操作</th>
                                    <th></th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr>
                                    <div class="row">
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="text" class="form-control"></td>
                                        <td><input type="text" class="form-control"></td>
                                        <td>

                                                    <textarea class="form-control"
                                                              style="height:34px;width: 100%;
                                                              resize:vertical"></textarea>
                                        </td>
                                        <td>
                                            <button type="submit" class="btn btn-info">保存</button>
                                        </td>
                                        <td>
                                            <button type="button" name="delete" class="btn btn-info">删除</button>
                                        </td>
                                    </div>
                                </tr>
                                <tr>
                                    <td style=" border: none"><span id="addRedisProperties"
                                                                    class="btn btn-info"><i
                                            class="icon icon-plus-sign"></i>添加redis配置</span></td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<script type="text/javascript">

    var servicePropertiesHtml = '<tr>';
    servicePropertiesHtml += '<div class="row">';
    servicePropertiesHtml += '<td>';
    servicePropertiesHtml += '<select class="form-control" name="serviceId">';
    servicePropertiesHtml += '<#if serviceList ??>';
    servicePropertiesHtml += '<#list serviceList as item>';
    servicePropertiesHtml += '<option values="${item.id}"> ${item.name}';
    servicePropertiesHtml += '</option>';
    servicePropertiesHtml += '</#list>';
    servicePropertiesHtml += '</#if>';
    servicePropertiesHtml += '</select>';
    servicePropertiesHtml += '</td>';
    servicePropertiesHtml += '<td><input type="text" class="form-control" name="ipAddress"></td>';
    servicePropertiesHtml += '<td><input type="text" class="form-control" name="httpPort"></td>';
    servicePropertiesHtml += '<td><input type="text" class="form-control" name="dubboPort"></td>';
    servicePropertiesHtml += '<td>';
    servicePropertiesHtml += '<button type="submit" class="btn btn-info" onclick="saveServiceProperties(this)">保存</button>';
    servicePropertiesHtml += '</td>';
    servicePropertiesHtml += '<td>';
    servicePropertiesHtml += '<button type="button" name="delete" class="btn btn-info">删除</button>';
    servicePropertiesHtml += '</td>';
    servicePropertiesHtml += '</div>';
    servicePropertiesHtml += '</tr>';


    var zkPropertiesHtml='<tr>';
    zkPropertiesHtml+='<div class="row">';
    zkPropertiesHtml+='<td>';
    zkPropertiesHtml+='<select class="form-control">';
    zkPropertiesHtml+='<#if serviceList ??>';
    zkPropertiesHtml+='<#list serviceList as item>';
    zkPropertiesHtml+='<option values="${item.id}"> ${item.name}</option>';
    zkPropertiesHtml+='</#list>';
    zkPropertiesHtml+='</#if>';
    zkPropertiesHtml+='</select>';
    zkPropertiesHtml+='</td>';
    zkPropertiesHtml+='<td><textarea type="text" class="form-control" style="width: 100% ;height: 34px;resize: vertical"></textarea></td>';
    zkPropertiesHtml+='<td>';
    zkPropertiesHtml+='<button type="submit" class="btn btn-info" onclick="saveZKProperties(this)">保存</button>';
    zkPropertiesHtml+='</td>';
    zkPropertiesHtml+='<td>';
    zkPropertiesHtml+='<button type="button" name="delete" class="btn btn-info">删除</button>';
    zkPropertiesHtml+='</td>';
    zkPropertiesHtml+='</div>';
    zkPropertiesHtml+='</tr>';

    var dbPropertiesHtml = '<tr>';
    dbPropertiesHtml += '<div class="row">';
    dbPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    dbPropertiesHtml += '<td>';
    dbPropertiesHtml += '<select class="form-control" >';
    dbPropertiesHtml += '<#if databaseTypeEnumList ??>';
    dbPropertiesHtml += '<#list databaseTypeEnumList as item>';
    dbPropertiesHtml += '<option values="${item.getId()}"> ${item.getName()}</option>';
    dbPropertiesHtml += '</#list>';
    dbPropertiesHtml += '</#if>';
    dbPropertiesHtml += '</select>';
    dbPropertiesHtml += '</td>';
    dbPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    dbPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    dbPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    dbPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    dbPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    dbPropertiesHtml += '<td>';
    dbPropertiesHtml += '<button type="submit" class="btn btn-info" onclick="saveDbProperties(this)">保存</button>';
    dbPropertiesHtml += '</td>';
    dbPropertiesHtml += '<td>';
    dbPropertiesHtml += '<button type="button" name="delete" class="btn btn-info">删除</button>';
    dbPropertiesHtml += '</td>';
    dbPropertiesHtml += '</div>';
    dbPropertiesHtml += '</tr>';

    var redisPropertiesHtml = '<tr>';
    redisPropertiesHtml += '<div class="row">';
    redisPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    redisPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    redisPropertiesHtml += '<td><input type="text" class="form-control"></td>';
    redisPropertiesHtml += '<td >';
    redisPropertiesHtml += '<textarea type="text" class="form-control" style="height: 34px;width: 100%;resize:vertical" ></textarea>';
    redisPropertiesHtml += '</td>';
    redisPropertiesHtml += '<td>';
    redisPropertiesHtml += '<button type="submit" class="btn btn-info" onclick="saveRedisProperties(this)">保存</button>';
    redisPropertiesHtml += '</td>';
    redisPropertiesHtml += '<td>';
    redisPropertiesHtml += '<button type="button" name="delete" class="btn btn-info">删除</button>';
    redisPropertiesHtml += '</td>';
    redisPropertiesHtml += '</div>';
    redisPropertiesHtml += '</tr>';

    $("input[name='serviceProperties']").click(function () {
        var type = $(this).val();
        if ( $(this).is(':checked')) {
            $("#service-form-div").addClass("in");
        } else {
            $("#service-form-div").removeClass("in");
        }
    });

    $("input[name='zkProperties']").click(function () {
        var type = $(this).val();
        if ( $(this).is(':checked')) {
            $("#zk-form-div").addClass("in");
        } else {
            $("#zk-form-div").removeClass("in");
        }
    });

    $("input[name='dbProperties']").click(function () {
        var type = $(this).val();
        if ( $(this).is(':checked')) {
            $("#db-form-div").addClass("in");
        } else {
            $("#db-form-div").removeClass("in");
        }
    });

    $("input[name='redisProperties']").click(function () {
        var type = $(this).val();
        if ( $(this).is(':checked')) {
            $("#redis-form-div").addClass("in");
        } else {
            $("#redis-form-div").removeClass("in");
        }
    });


    $("#addServiceProperties").click(function () {
        $(this).parent().parent().before(servicePropertiesHtml);
        $("button[name='delete']").click(function () {
            $(this).parent().parent().remove();
        });

    });
    $("#addZkProperties").click(function () {
        $(this).parent().parent().before(zkPropertiesHtml);
        $("button[name='delete']").click(function () {
            $(this).parent().parent().remove();
        });

    });
    $("#addRedisProperties").click(function () {
        $(this).parent().parent().before(redisPropertiesHtml);
        $("button[name='delete']").click(function () {
            $(this).parent().parent().remove();
        });

    });
    $("#addDbProperties").click(function () {
        $(this).parent().parent().before(dbPropertiesHtml);
        $("button[name='delete']").click(function () {
            $(this).parent().parent().remove();
        });
    });
    $("button[name='delete']").click(function () {
        $(this).parent().parent().remove();
    });

    function saveEnvironment(){
        //ajax提交form表单的方式
        var AjaxURL= "${basePath}/autotest/environment/saveEnvironment";
        $.ajax({
            type: "POST",
            dataType: "html",
            url: AjaxURL,
            data: $('#add-environment').serialize(),
            success: function (result) {
                data = eval("(" + result + ")");
                if (data.code == 0) {
                    // $("#addService").modal("hide");
                    reload();
                } else {
                    alert("保存失败："+data.message);
                }
            },
            error: function(result) {
                alert(eval("(" + result + ")").message);
            }
        });
    }

    function saveServiceProperties(_this){
        var serviceId = $(_this).parent().parent().find("select[name='serviceId']").val();
        var ipAddress = $(_this).parent().parent().find("input[name='ipAddress']").val();
        var httpPort = $(_this).parent().parent().find("input[name='httpPort']").val();
        var dubboPort = $(_this).parent().parent().find("input[name='dubboPort']").val();
        var AjaxURL= "${basePath}/autotest/environment/saveServiceProperties";
        $.ajax({
            type: "POST",
            dataType: "html",
            url: AjaxURL,
            data: $('#add-environment').serialize(),
            success: function (result) {
                data = eval("(" + result + ")");
                if (data.code == 0) {
                    // $("#addService").modal("hide");
                    reload();
                } else {
                    alert("保存失败："+data.message);
                }
            },
            error: function(result) {
                alert(eval("(" + result + ")").message);
            }
        });
        alert();
    }

    function saveDbProperties(_this){

    }

    function saveZKProperties(_this){

    }

    function saveRedisProperties(_this){

    }

</script>
</body>

</html>